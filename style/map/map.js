var map = L.map('map', {
    center: [-6.953034354375685, 107.69787378906406], // Koordinat pusat kota Bandung
    zoom: 13,
    maxBounds: [
        [-6.984189685856107, 107.66200533120254], // Koordinat kiri bawah batas kota Bandung
        [-6.9106616758774315, 107.73521890644103]  // Koordinat kanan atas batas kota Bandung
    ]
});

// Tile layer untuk mode terang (light mode)
var lightTiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map); // Light mode sebagai mode default

// Tile layer untuk mode gelap (dark mode)
var darkTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/">CARTO</a>',
    subdomains: 'abcd',
    maxZoom: 19
});

// Kontrol layer untuk beralih antara Light Mode dan Dark Mode
L.control.layers({
    "Light Mode": lightTiles,
    "Dark Mode": darkTiles
}).addTo(map);




// Mengambil data marker dari PHP
fetch('get_markers.php')
    .then(response => response.json())
    .then(data => {
        data.forEach(marker => {
            L.marker([marker.latitude, marker.longitude])
                .addTo(map)
                .bindPopup(marker.description); 
        });
    })
    .catch(error => console.error('Error fetching marker data:', error));

// Icon maker
var iconBanjir = L.icon({
    iconUrl: 'img/map.png',
    iconSize: [38, 45],
    iconAnchor: [12, 41], 
    popupAnchor: [8, -35] 
});

// Village polygons with unique colors
const villagePolygons = {
    "Rancabolang": {
        coordinates: [
            [-6.949838032023233, 107.68595402304403],
            [-6.9517248017414355, 107.68550838295404],
            [-6.951699443073264, 107.68515924817075],
            [-6.952206615689811, 107.68498893852015],
            [-6.9521897099447445, 107.68501448496774],
            [-6.952502466129991, 107.68533807330385],
            [-6.953254770727714, 107.68575533197084],
            [-6.953567526203977, 107.68563611521543],
            [-6.953821111572416, 107.6858319713136],
            [-6.954539602721011, 107.6859511880682],
            [-6.955367979370151, 107.68598524999831],
            [-6.955985034528358, 107.68575533195889],
            [-6.956585183256559, 107.6857297855113],
            [-6.956627447250981, 107.68573830102513],
            [-6.957962986618234, 107.68662391120819],
            [-6.958292644513582, 107.68627477642858],
            [-6.959391502418377, 107.68617259065017],
            [-6.95994938312888, 107.68648766350378],
            [-6.9603466614299645, 107.68644508608575],
            [-6.960642506741792, 107.686513209946],
            [-6.962189352074646, 107.68630883836609],
            [-6.962341500517994, 107.68685382924798],
            [-6.96548589071324, 107.68704116986113],
            [-6.965578869669925, 107.68690492214066],
            [-6.969387909555022, 107.68639706888713],
            [-6.967481308774649, 107.70477365462907],
            [-6.963747585906943, 107.70480226358089],
            [-6.963719630469534, 107.70462926109985],
            [-6.963739598638379, 107.70460109790223],
            [-6.963717633652077, 107.70455818256006],
            [-6.963694337453354, 107.7045347132323],
            [-6.963701659113436, 107.70448643346248],
            [-6.963654401107481, 107.70439725001705],
            [-6.963651738683236, 107.70418602605402],
            [-6.963483340393451, 107.7040130235704],
            [-6.963450725698628, 107.70395803828825],
            [-6.963394149179589, 107.70390908797302],
            [-6.963302961132242, 107.70379710575205],
            [-6.96322508519457, 107.7037548609621],
            [-6.963223753981856, 107.70375217875323],
            [-6.963205782607795, 107.70372066279465],
            [-6.963193801691686, 107.70344774802348],
            [-6.96312590983188, 107.70335118849836],
            [-6.963123247405599, 107.70323518296199],
            [-6.96314854045226, 107.70309436699111],
            [-6.9631465436328455, 107.70300585409791],
            [-6.962939539970547, 107.70278658350497],
            [-6.962954183319857, 107.70266923685857],

            [-6.963034056122579, 107.70243454357329],
            [-6.9630140879226525, 107.70235005399032],
            [-6.96301475352836, 107.70234938343312],
            [-6.962834374087475, 107.70226489385165],
            [-6.96274851078604, 107.70197320361885],
            [-6.962745848357901, 107.701834399309],
            [-6.9628017593465845, 107.7017619796603],

            [-6.9628010937405715, 107.70175996799892],
            [-6.962910918878029, 107.70169425387783],
            [-6.96292423101339, 107.70097005744753],
            [-6.962867654433082, 107.70085405191325],
            [-6.962870982466432, 107.70085405190737],
            [-6.962668637933791, 107.70078699668402],
            [-6.962335168625206, 107.70031761009436],
            [-6.962318528434344, 107.70018484075455],
            [-6.9622925697339095, 107.69996959348236],
            [-6.962291238517708, 107.69996959347888],
            [-6.961745439888936, 107.69970271368288],
            [-6.961665566867023, 107.69962090631188],
            [-6.961647595435228, 107.6995209940309],
            [-6.961672222952705, 107.69944656273434],
            [-6.9619890525274855, 107.69953239341918],
            [-6.9620296546206655, 107.69946600874928],
            [-6.962029654620944, 107.69930105288772],
            [-6.96192315731799, 107.69891883810297],
            [-6.961541098044935, 107.69864793499036],
            [-6.9615171361281405, 107.69814300914447],
            [-6.961191653315449, 107.69788283486851],
            [-6.961189656487702, 107.69779163976641],
            [-6.961242905223125, 107.69752945383203],
            [-6.9610299102342275, 107.69746105749867],
            [-6.960784300270273, 107.6970573850433],
            [-6.960783634660454, 107.69705604393886],
            [-6.96078496588009, 107.69697155435898],
            [-6.960857517345556, 107.69672948499881],
            [-6.960831558565809, 107.69667382916444],
            [-6.96082756490726, 107.69667047640336],
            [-6.960780306611825, 107.69664968928448],
            [-6.9606691497573445, 107.69663493713561],
            [-6.960346328795611, 107.69674893101484],
            [-6.960231178171388, 107.69669863959157],
            [-6.960008864172285, 107.69647936900246],
            [-6.960051463268003, 107.69614275176836],
            [-6.960007532949061, 107.69606697936734],
            [-6.959916344243594, 107.69606764991956],
            [-6.959299322378531, 107.69631374259504],
            [-6.9589512072033655, 107.69621651251714],
            [-6.958752189042159, 107.69606966157596],
            [-6.958431363603242, 107.69624065239901],
            [-6.9583015690192465, 107.69622522969792],
            [-6.958230348386101, 107.69616689165467],
            [-6.9582150392766335, 107.69607234379144],
            [-6.9582270203156895, 107.69584100325712],
            [-6.958039317285551, 107.69580009957163],
            [-6.957470217200545, 107.69598450144163],
            [-6.957435605241526, 107.69553389032491],
            [-6.9573657157063655, 107.6954742111772],
            [-6.956995633796015, 107.69549633940228],
            [-6.956912431889304, 107.69547957559674],
            [-6.956593602038062, 107.69512686511017],
            [-6.9560491280171615, 107.69512887676738],
            [-6.956013184720697, 107.6948754080127],
            [-6.955952613607339, 107.6947969534028],
            [-6.955780884469948, 107.69476409634075],
            [-6.955569883856526, 107.69478555401507],
            [-6.9550973925170005, 107.69490422855537],
            [-6.954887722832817, 107.69487874757081],
            [-6.954748608609122, 107.69471178005848],
            [-6.954792539419407, 107.69434632907105],
            [-6.95454027000613, 107.69406872044524],
            [-6.9544823611778614, 107.69396880816426],
            [-6.9544677175649845, 107.69387493085326],
            [-6.954507654689914, 107.69380720506983],
            [-6.954469048802519, 107.69387224863532],
            [-6.954506989071191, 107.6938092167265],
            [-6.954678053054373, 107.69379111181642],
            [-6.954875741704107, 107.69382598053271],
            [-6.954923666212012, 107.69374551426615],
            [-6.954934981720103, 107.69369321119288],
            [-6.9549256630664, 107.69362883817963],
            [-6.954842460790834, 107.69359262834581],
            [-6.9547838863815015, 107.69353361975034],
            [-6.954964268917168, 107.69325735221825],
            [-6.954956281500213, 107.69315811048949],
            [-6.9547679115443195, 107.69308770250625],
            [-6.954697355990871, 107.69303204666228],
            [-6.954750605464146, 107.69267732452425],
            [-6.95480119245805, 107.69257607113884],
            [-6.954770574014225, 107.69243458460463],
            [-6.954686706093208, 107.69235948275144],
            [-6.954605500631841, 107.69234003673552],
            [-6.954123592522953, 107.69240642140842],
            [-6.954047046301215, 107.69236283551405],
            [-6.954003115417814, 107.6922977919458],
            [-6.953952528335974, 107.69214088271224],
            [-6.953956522052995, 107.6919859851491],
            [-6.954299315978147, 107.69172446976486],
            [-6.95438215407281, 107.69127030375321],
            [-6.954408113209148, 107.69118916693444],
            [-6.954367510456804, 107.69110803011566],
            [-6.954300948560134, 107.69104700986352],
            [-6.954233721034923, 107.69102354053577],
            [-6.9541884589333245, 107.69096855525362],
            [-6.954140534346732, 107.6907787889533],
            [-6.954042688308091, 107.69058164660022],
            [-6.953946839102529, 107.6904689938177],
            [-6.953873620950093, 107.69043881896778],
            [-6.95194497305978, 107.69060289770552],
            [-6.951780564308059, 107.69050231486659],
            [-6.9517639237431395, 107.6903990498245],
            [-6.951836884262961, 107.69031132910125],
            [-6.952067855215385, 107.69012089227041],
            [-6.952083164525213, 107.6900484726305],
            [-6.951993971146933, 107.68990296279438],
            [-6.951690447284093, 107.6898137793426],
            [-6.951560650834906, 107.68982115541739],
            [-6.951563978947694, 107.68982048486414],
            [-6.951466797995491, 107.68973063086649],
            [-6.951461473010415, 107.68965552900762],
            [-6.951563978947337, 107.68945034001811],
            [-6.951530032177844, 107.6893584743584],
            [-6.951376273251894, 107.68924380992426],
            [-6.951317032785785, 107.68913853322002],
            [-6.951380932613502, 107.68899838779556],
            [-6.951430188725177, 107.68894340251241],
            [-6.951848816867779, 107.68873304798659],
            [-6.951898072929303, 107.68868208601779],
            [-6.9518967416844655, 107.68862106576564],
            [-6.951880766746105, 107.68858016208014],
            [-6.951594549003016, 107.68857479766127],
            [-6.9514773993671515, 107.68845409826145],
            [-6.95152133048422, 107.6883313871895],
            [-6.951674423738193, 107.68826433196736],
            [-6.951688401815423, 107.68816240802974],
            [-6.951624502030427, 107.68813357428422],
            [-6.951543961661109, 107.68762663677425],
            [-6.951259740583333, 107.68773861899722],
            [-6.9511579002039765, 107.68772721960946],
            [-6.950801125883962, 107.68749587908472],
            [-6.950799129012043, 107.68739529625152],
            [-6.950856372668671, 107.68727929070658],
            [-6.950797132138406, 107.68720150664892],
            [-6.949838032023233, 107.68595402304403]
        ],
        color: 'red', // Unique border color
        fillColor: 'pink' // Unique fill color
    },
    "Cisaranten": {
        coordinates: [   
            [-6.938045835255355, 107.67983803555732], 
            [-6.947460581827743, 107.67923722076702],
            [-6.948227385467171, 107.68262753279805],
            [-6.948014384581664, 107.68271336348236], 
            [-6.949616484978263, 107.68303005872495],
            [-6.949802449158753, 107.6829278729346],
            [-6.949827807904937, 107.68297896582976],
            [-6.950005319089919, 107.68306412065506],
            [-6.950072942380851, 107.68331106964841],
            [-6.951712804234727, 107.68314075999291],
            [-6.951957937727444, 107.68503119711445],
            [-6.951704351353389, 107.68515041386986],
            [-6.951721257115925, 107.6855080641361],
            [-6.951755068639149, 107.68552509510117],
            [-6.950723816077951, 107.68552509509911],
            [-6.950571663870366, 107.68559321895934],
            [-6.950360341278121, 107.68558470347682],
            [-6.949819355009033, 107.685925322778],
            [-6.950647739988503, 107.68714303683733],
            [-6.950825250863827, 107.68721967618008],
            [-6.950799892171457, 107.68747514065596],
            [-6.951247895535189, 107.68773912061438],
            [-6.951543746578974, 107.68761990385897],
            [-6.951602916765396, 107.68810528636317],
            [-6.951695898471836, 107.6881819257059],
            [-6.9514930292704165, 107.68848848307698],
            [-6.951890314707672, 107.68859918434987],
            [-6.951501482155557, 107.68846293662939],
            [-6.951898767587624, 107.68860769988461],
            [-6.951332424425798, 107.68913565980144],
            [-6.951552199465171, 107.68942518620744],
            [-6.951476123501635, 107.68971471261344],
            [-6.952066508797684, 107.69004414837352],
            [-6.95181090981121, 107.69052694597286],
            [-6.953908947393815, 107.6904518441966],
            [-6.95420714487758, 107.69099901486052],
            [-6.95439884315273, 107.69112776088703],
            [-6.954292344120647, 107.69171784684178],
            [-6.953972846879482, 107.69195388122368],
            [-6.9541006458020265, 107.6923723058098],
            [-6.954771589574916, 107.69258688252062],
            [-6.954942373122256, 107.69315658429957],
            [-6.954795309515746, 107.69354847484132],
            [-6.954923397175622, 107.69361538298261],
            [-6.954861725343749, 107.6938208865594],
            [-6.954506337068754, 107.69380724914332],
            [-6.954466801331224, 107.69387078551568],
            [-6.95478967642736, 107.69434114435094],
            [-6.954747316736255, 107.69470813805347],
            [-6.95488757437301, 107.69487788448117],
            [-6.955095087792844, 107.69489990727732],
            [-6.955942482289716, 107.69478920600378],
            [-6.956012217927071, 107.69488926292351],
            [-6.956048142342273, 107.69512982530496],
            [-6.956597574248821, 107.6951234387092],
            [-6.956903987908317, 107.69547470236353],
            [-6.9569906289757615, 107.6954981199405],
            [-6.9573731174124855, 107.69547470237208],
            [-6.957444966031904, 107.69554069736168],
            [-6.9574660979767, 107.69597711584133],
            [-6.958036660142681, 107.6957940329712],
            [-6.958220507798871, 107.69583661038382],
            [-6.958233186944923, 107.69617084307312],
            [-6.958427600474794, 107.69624748241588],
            [-6.958755144832754, 107.69607078615422],
            [-6.958955897718991, 107.69621129164071],
            [-6.959300347192013, 107.69631347743105],
            [-6.959913170800264, 107.69606652845793],
            [-6.960001924495383, 107.6960643995873],
            [-6.960046301336644, 107.69614955441261],
            [-6.960006150861391, 107.69646888500745],
            [-6.960242827304412, 107.6967030608007],
            [-6.960348486389138, 107.69674989595462],
            [-6.9606570107804036, 107.69663919468174],
            [-6.9608514233108165, 107.69672860725005],
            [-6.960781688392293, 107.69697342737278],
            [-6.9610289303382675, 107.69746093878032],
            [-6.96124024812996, 107.69752054715805],
            [-6.961185305513272, 107.69788245516554],
            [-6.961517074305333, 107.69814430628568],
            [-6.961540593872351, 107.69884932603789],
            [-6.961926646798739, 107.69890833467326],
            [-6.9620224943700695, 107.69946891633028],
            [-6.9620358065312065, 107.69946086970363],
            [-6.961990545181797, 107.69953328934352],
            [-6.961673715613709, 107.69944745865921],
            [-6.961641766401697, 107.6995171960902],
            [-6.961671053179463, 107.69962180223673],
            [-6.962296724821588, 107.6999624428079],
            [-6.962336661280522, 107.70031649438076],
            [-6.962339323711002, 107.70031381217187],
            [-6.9626668025441925, 107.70078856314458],
            [-6.96286914708205, 107.70085293618908],
            [-6.9629223956282305, 107.70098704663334],
            [-6.962903758637864, 107.70170051424024],
            [-6.962749337831118, 107.70181853143119],
            [-6.962831873096227, 107.70226109589727],
            [-6.96300493086479, 107.70234156218781],
            [-6.963039542411814, 107.7024434861449],
            [-6.962938370194136, 107.70278680888224],
            [-6.963127402477871, 107.70334202612148],
            [-6.963127402477871, 107.70335275495702],
            [-6.963207275250923, 107.70372558199207],
            [-6.963303122567389, 107.703792637272],
            [-6.963646575266379, 107.70418155756039],
            [-6.963659887381425, 107.7043988164801],
            [-6.963697161301563, 107.70453024471549],
            [-6.96373443521875, 107.7045972999376],
            [-6.963739760063806, 107.70480919443955],
            [-6.952085932938556, 107.70585717986629],
            [-6.951192871171058, 107.70556445673309],
            [-6.950758792724701, 107.7052992137285],
            [-6.950296249683198, 107.70460384695039],
            [-6.949797167134089, 107.6998861264635],
            [-6.949645357877166, 107.69977740073391],
            [-6.94949710660238, 107.69975350496918],
            [-6.9466282481386195, 107.69980938070469],
            [-6.945511268396067, 107.69997355467123],
            [-6.9452539018903705, 107.69993173708292],
            [-6.945251529841697, 107.69993532144717],
            [-6.9450890449237415, 107.69997594424723],
            [-6.944879119062518, 107.70018622698927],
            [-6.944714261971032, 107.70026508301292],
            [-6.944575497324047, 107.70028300483649],
            [-6.937823880859014, 107.68184144819895],
            [-6.9378298581250055, 107.68183542684365],
            [-6.938045835255355, 107.67983803555732]
        ],
        color: 'green',
        fillColor: 'lightgreen'
    },
    "Cimencrang": {
        coordinates: [
            [-6.955160281438553, 107.70574728945165],
            [-6.955625186302214, 107.71360708010572],
            [-6.955532205373471, 107.71363262655332],
            [-6.954348810102447, 107.71272146993662],
            [-6.953951526744078, 107.71261928414627],
            [-6.9533344689467995, 107.71288326410469],
            [-6.952987901883319, 107.71287474862216],
            [-6.952472277212888, 107.71312169763243],
            [-6.95062109551011, 107.71292584154699],
            [-6.949410851538017, 107.71335235326427],
            [-6.949327143777978, 107.71349602977504],
            [-6.94659007709553, 107.70585430471024],
            [-6.941951116501726, 107.70698468314602],
            [-6.9417779076753385, 107.70690123239171],
            [-6.941469143957167, 107.70652191078128],
            [-6.936009264175646, 107.70670398514557],
            [-6.9367984913888145, 107.69615408889399],
            [-6.936850792577523, 107.69610140203496],
            [-6.937248281426925, 107.6963016121149],
            [-6.937302076883835, 107.69644311396485],
            [-6.937305065520144, 107.69644461930369],
            [-6.937287133701981, 107.69650784353452],
            [-6.937296099611152, 107.6965575197159],
            [-6.937396218918645, 107.69666439877278],
            [-6.937402196190068, 107.69670203224352],
            [-6.9373005825656735, 107.69689772629131],
            [-6.9373140314289845, 107.6969323490844],
            [-6.937358860970579, 107.69695793984448],
            [-6.937447025723266, 107.6969474024727],
            [-6.937544156363889, 107.6968615981594],
            [-6.9376069176902515, 107.69672160164829],
            [-6.937605423373057, 107.69672009630945],
            [-6.937681633544067, 107.6966809574999],
            [-6.937741406218587, 107.6966764414834],
            [-6.937837042491929, 107.69671558029795],
            [-6.937838536808729, 107.69671558030208],
            [-6.937965553690673, 107.69686460884618],
            [-6.9379506105298745, 107.69697449858072],
            [-6.938004405907652, 107.69714008586143],
            [-6.937977508220086, 107.69716417128271],
            [-6.937968542323891, 107.69720782610875],
            [-6.938181873399103, 107.69727298792368],
            [-6.938225805757733, 107.69734943087691],
            [-6.938360265383158, 107.69735345420082],
            [-6.938406860291184, 107.69731858548532],
            [-6.938871477838929, 107.6974889057592],
            [-6.938947360890108, 107.69788855488312],
            [-6.9389100850068415, 107.6979167180764],
            [-6.938747668623897, 107.69791403586751],
            [-6.9386944173385965, 107.69797438556743],
            [-6.938667791693695, 107.6981809156516],
            [-6.9387556563172685, 107.69821578437715],
            [-6.938806245033355, 107.69827881629469],
            [-6.938859496305997, 107.69826942856358],
            [-6.939171016138483, 107.69799450215115],
            [-6.93976876087295, 107.69844243105665],
            [-6.939951146083842, 107.69837269362563],
            [-6.939988421884667, 107.69837269362563],
            [-6.939988421884667, 107.69837269362563],
            [-6.940019041290292, 107.69842231449002],
            [-6.939760773197874, 107.69880452925617],
            [-6.939873931915595, 107.69890377098493],
            [-6.93992318923845, 107.698886336645],
            [-6.939943158419019, 107.69883805688507],
            [-6.940012384905102, 107.69880587037845],
            [-6.940097586720132, 107.69867444214307],
            [-6.940192107465647, 107.69861141023428],
            [-6.9404197559507805, 107.69852021512833],
            [-6.940471675763706, 107.69852289733721],
            [-6.940668704750369, 107.69883001026889],
            [-6.9407459187900695, 107.69884342131246],
            [-6.940897684279672, 107.6987803894022],
            [-6.941157283028983, 107.69859531698631],
            [-6.9413183673088215, 107.69864493785548],
            [-6.941315704762786, 107.69895205078406],
            [-6.941347655356761, 107.6990097182751],
            [-6.941408893989148, 107.6990325170506],
            [-6.941467470064837, 107.69901910600618],
            [-6.941607253855075, 107.6988903599824],
            [-6.941784313259682, 107.69898557839784],
            [-6.941725737223431, 107.69934633549292],
            [-6.9422103205863746, 107.70021805342857],
            [-6.942575089052444, 107.70016306814723],
            [-6.949712081364842, 107.69984807906275],
            [-6.9503206909875335, 107.70471893486838],
            [-6.9516055309362255, 107.70570673080101],
            [-6.955160281438553, 107.70574728945165] // Close the polygon
        ],
        color: 'blue',
        fillColor: 'cyan'
    },
    "Rancamumpang": {
        coordinates: [
            [-6.955179571065776, 107.70573779243445],
            [-6.964039005846754, 107.70480738840746],
            [-6.967276498391002, 107.70478593073636],
            [-6.961688623264226, 107.71598443632821],
            [-6.961257535280136, 107.71612494178996],
            [-6.961265987989506, 107.71612494178996],
            [-6.960864484115238, 107.71608236438102],
            [-6.960868710473484, 107.71608236438102],
            [-6.960851805040265, 107.7159759208494],
            [-6.960344641741331, 107.71589076602223],
            [-6.960348868104261, 107.71588650828097],
            [-6.9602389826557385, 107.71593760117614],
            [-6.960251661747276, 107.71615048823938],
            [-6.960103738991473, 107.71637614852641],
            [-6.960053022607338, 107.71655071591826],
            [-6.959533179353856, 107.71669973686252],
            [-6.959266917952264, 107.71664012848483],
            [-6.958748856432817, 107.71618134302561],
            [-6.9587044095979405, 107.71600730539193],
            [-6.958639835886932, 107.7159608390334],
            [-6.958155113447556, 107.71600561570496],
            [-6.958013386553718, 107.7160309609914],
            [-6.957846500980598, 107.71603349551961],
            [-6.957630136681506, 107.71588649285434],
            [-6.957490925494403, 107.71582988838124],
            [-6.957038069528445, 107.71582819869325],
            [-6.956155837769107, 107.71565585073628],
            [-6.956003208154858, 107.71555869380485],
            [-6.956003706782706, 107.71556239918901],
            [-6.955877239608531, 107.7153444696981],
            [-6.955804021755743, 107.71506283775233],
            [-6.95580135928809, 107.71490995183962],
            [-6.955872580290548, 107.71467659965991],
            [-6.95597907896679, 107.71459948614968],
            [-6.956136830082943, 107.71453913644977],
            [-6.956242663083376, 107.71436076954406],
            [-6.956259982545085, 107.7139448399093],
            [-6.956019003652978, 107.71355413863023],
            [-6.955834504114027, 107.71351051664413],
            [-6.955819442923962, 107.71351430986033],
            [-6.955617999460566, 107.71361862330534],
            [-6.955162568013204, 107.7057299430806], 
            [-6.955179571065776, 107.70573779243445] // Close the polygon
        ],
        color: 'purple',
        fillColor: 'violet'
    }
};

Object.entries(villagePolygons).forEach(([villageName, { coordinates, color, fillColor }]) => {
    const polygon = L.polygon(coordinates, {
        color: color, // Border color
        fillColor: fillColor, // Fill color
        fillOpacity: 0.5 // Transparency
    }).addTo(map);

    // Fetch data from the server
    fetch(`connection.php?villageName=${encodeURIComponent(villageName)}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                const villageData = data.data.villageTotal;
                const rwData = data.data.rwData; // Data per RW

                const popupContent = `
                    <strong>Desa:</strong> ${villageName}<br><br>
                    Jumlah SD: ${villageData.total_sd}<br>
                    Jumlah SMP: ${villageData.total_smp}<br>
                    Jumlah SMA: ${villageData.total_sma}<br>
                    Jumlah SMK: ${villageData.total_smk}<br>
                    Jumlah S1: ${villageData.total_s1}<br>
                    Jumlah S2: ${villageData.total_s2}<br>
                    Jumlah S3: ${villageData.total_s3}<br><br>
                   
                `;
                polygon.bindPopup(popupContent);

                let originalPopup;

                // Add event listener for the button click
                polygon.on('popupopen', function () {
                    // Store the reference to the original popup
                    originalPopup = polygon.getPopup();

                    const button = document.getElementById('showDetailsButton');
                    if (button) {
                        button.addEventListener('click', function () {
                            // Create a table popup with more detailed data
                            const tableRows = rwData.map(rw => {
                                return `
                                    <tr>
                                        <td>RW ${rw.rw}</td>
                                        <td>${rw.total_sd}</td>
                                        <td>${rw.total_smp}</td>
                                        <td>${rw.total_sma}</td>
                                        <td>${rw.total_smk}</td>
                                        <td>${rw.total_s1}</td>
                                        <td>${rw.total_s2}</td>
                                        <td>${rw.total_s3}</td>
                                    </tr>
                                `;
                            }).join('');

                            const tableContent = `
                                <style>
                                    table {
                                        width: 30%;
                                        border-collapse: collapse;
                                    }
                                    th, td {
                                        border: 1px solid #ddd;
                                        padding: 8px;
                                        text-align: left;
                                    }
                                    th {
                                        background-color: #f2f2f2;
                                    }
                                    tr:nth-child(even) {
                                        background-color: #f9f9f9;
                                    }
                                    tr:hover {
                                        background-color: #ddd;
                                    }
                                    button {
                                        margin-top: 10px;
                                        padding: 5px 10px;
                                        background-color: #12192C;
                                        color: white;
                                        border: none;
                                        cursor: pointer;
                                    }
                                    button:hover {
                                        background-color: #12192C;
                                    }
                                </style>
                                <table>
                                    <tr><th>RW</th><th>SD</th><th>SMP</th><th>SMA</th><th>SMK</th><th>S1</th><th>S2</th><th>S3</th></tr>
                                    ${tableRows}
                                </table>
                                <br>
                                <button id="backButton">Back</button>
                            `;

                            // Create a second popup for the table with custom size
                            const tablePopup = L.popup({
                                maxWidth: 900, // Set maximum width of the popup
                                minWidth: 900, // Set minimum width of the popup
                                maxHeight: 200, // Set maximum height of the popup
                                className: 'table-popup' // Optionally add custom class for styling
                            })
                            .setLatLng(polygon.getBounds().getCenter()) // Position the table popup at the polygon's center
                            .setContent(tableContent)
                            .openOn(map);

                            // Add event listener for the "Back" button to return to the original popup
                            const backButton = document.getElementById('backButton');
                            if (backButton) {
                                backButton.addEventListener('click', function () {
                                    tablePopup.remove(); // Close the table popup
                                    originalPopup.openOn(map); // Reopen the original popup
                                });
                            }
                        });
                    }
                });
            } else {
                polygon.bindPopup(`Desa: ${villageName} - Data tidak tersedia`);
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            polygon.bindPopup(`Desa: ${villageName} - Error loading data`);
        });
});




// document.getElementById('add-location-btn').addEventListener('click', function() {
//     alert('Tambahkan Lokasi button clicked');
//     // Fungsi untuk menambahkan lokasi bisa ditambahkan di sini
// });

// document.getElementById('add-flood-point-btn').addEventListener('click', function() {
//     alert('Tambahkan Titik Banjir button clicked');
//     // Fungsi untuk menambahkan titik banjir bisa ditambahkan di sini
// });